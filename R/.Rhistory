(function(data) {
Sigma <- cov(data)
n <- ncol(data)
obj <- function(w) {
w <- w / sum(w)
Rp <- sum(w * mu)
if (Rp <= rf) return(Inf)
as.numeric(t(w) %*% Sigma %*% w)
}
res <- optim(
par    = rep(1, n),
fn     = obj,
method = "L-BFGS-B",
lower  = rep(0, n)                      # w>=0
)
w <- res$par / sum(res$par)
names(w) <- colnames(data)
print(formatC(w, format = "f", digits = 2))
invisible(w)
})(get_returns)
